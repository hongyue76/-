<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ³¨å†ŒåŠŸèƒ½éªŒè¯</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 600px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .success { background-color: #f6ffed; border-color: #b7eb8f; }
        .error { background-color: #fff2f0; border-color: #ffccc7; }
        .info { background-color: #e6f7ff; border-color: #91d5ff; }
        button {
            padding: 10px 20px;
            margin: 5px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            background: #1890ff;
            color: white;
        }
        button:hover { background: #40a9ff; }
        .result { 
            margin: 10px 0; 
            padding: 10px; 
            border-radius: 4px;
            font-family: monospace;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ” æ³¨å†ŒåŠŸèƒ½éªŒè¯æµ‹è¯•</h1>
        
        <div class="test-section info">
            <h3>æµ‹è¯•ç›®æ ‡</h3>
            <p>éªŒè¯å‰ç«¯æ³¨å†ŒåŠŸèƒ½æ˜¯å¦èƒ½æ­£ç¡®è¿æ¥åˆ°åç«¯API</p>
        </div>
        
        <div class="test-section">
            <h3>1. ç›´æ¥APIæµ‹è¯•</h3>
            <button onclick="testDirectApi()">æµ‹è¯•åç«¯APIç›´è¿</button>
            <div id="directApiResult" class="result"></div>
        </div>
        
        <div class="test-section">
            <h3>2. å‰ç«¯ä»£ç†æµ‹è¯•</h3>
            <button onclick="testProxyApi()">æµ‹è¯•å‰ç«¯ä»£ç†</button>
            <div id="proxyApiResult" class="result"></div>
        </div>
        
        <div class="test-section">
            <h3>3. å®Œæ•´æ³¨å†Œæµç¨‹æµ‹è¯•</h3>
            <button onclick="testFullRegistration()">æµ‹è¯•å®Œæ•´æ³¨å†Œ</button>
            <div id="registrationResult" class="result"></div>
        </div>
        
        <div class="test-section">
            <h3>4. ç½‘ç»œè¿æ¥æ£€æŸ¥</h3>
            <button onclick="checkNetwork()">æ£€æŸ¥ç½‘ç»œè¿æ¥</button>
            <div id="networkResult" class="result"></div>
        </div>
    </div>

    <script>
        function showResult(elementId, message, type = 'info') {
            const element = document.getElementById(elementId);
            element.innerHTML = `<div class="${type}">${message}</div>`;
        }

        async function testDirectApi() {
            showResult('directApiResult', 'æ­£åœ¨æµ‹è¯•åç«¯APIç›´è¿...', 'info');
            
            try {
                const response = await fetch('http://localhost:8001/api/auth/register', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        username: 'apitest' + Date.now(),
                        email: 'api' + Date.now() + '@test.com',
                        password: 'testpass123'
                    })
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    showResult('directApiResult', `âœ… åç«¯APIç›´è¿æˆåŠŸ<br>å“åº”: ${JSON.stringify(data)}`, 'success');
                } else {
                    showResult('directApiResult', `âŒ åç«¯APIç›´è¿å¤±è´¥<br>çŠ¶æ€: ${response.status}<br>é”™è¯¯: ${JSON.stringify(data)}`, 'error');
                }
            } catch (error) {
                showResult('directApiResult', `âŒ åç«¯APIè¿æ¥é”™è¯¯<br>é”™è¯¯ä¿¡æ¯: ${error.message}`, 'error');
            }
        }

        async function testProxyApi() {
            showResult('proxyApiResult', 'æ­£åœ¨æµ‹è¯•å‰ç«¯ä»£ç†...', 'info');
            
            try {
                const response = await fetch('/api/auth/register', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        username: 'proxytest' + Date.now(),
                        email: 'proxy' + Date.now() + '@test.com',
                        password: 'testpass123'
                    })
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    showResult('proxyApiResult', `âœ… å‰ç«¯ä»£ç†æˆåŠŸ<br>å“åº”: ${JSON.stringify(data)}`, 'success');
                } else {
                    showResult('proxyApiResult', `âŒ å‰ç«¯ä»£ç†å¤±è´¥<br>çŠ¶æ€: ${response.status}<br>é”™è¯¯: ${JSON.stringify(data)}`, 'error');
                }
            } catch (error) {
                showResult('proxyApiResult', `âŒ å‰ç«¯ä»£ç†è¿æ¥é”™è¯¯<br>é”™è¯¯ä¿¡æ¯: ${error.message}`, 'error');
            }
        }

        async function testFullRegistration() {
            showResult('registrationResult', 'æ­£åœ¨æµ‹è¯•å®Œæ•´æ³¨å†Œæµç¨‹...', 'info');
            
            // æ¨¡æ‹Ÿå‰ç«¯æ³¨å†Œè¡¨å•æäº¤
            const formData = {
                username: 'fulltest' + Date.now(),
                email: 'full' + Date.now() + '@test.com',
                password: 'testpass123',
                confirmPassword: 'testpass123'
            };
            
            try {
                // éªŒè¯å¯†ç ç¡®è®¤
                if (formData.password !== formData.confirmPassword) {
                    throw new Error('å¯†ç ç¡®è®¤ä¸åŒ¹é…');
                }
                
                // å‘é€æ³¨å†Œè¯·æ±‚
                const response = await fetch('/api/auth/register', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        username: formData.username,
                        email: formData.email,
                        password: formData.password
                    })
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    showResult('registrationResult', `âœ… å®Œæ•´æ³¨å†Œæµç¨‹æˆåŠŸ<br>ç”¨æˆ·: ${data.username}<br>é‚®ç®±: ${data.email}`, 'success');
                } else {
                    showResult('registrationResult', `âŒ æ³¨å†Œå¤±è´¥<br>çŠ¶æ€: ${response.status}<br>é”™è¯¯: ${JSON.stringify(data)}`, 'error');
                }
            } catch (error) {
                showResult('registrationResult', `âŒ æ³¨å†Œæµç¨‹é”™è¯¯<br>é”™è¯¯ä¿¡æ¯: ${error.message}`, 'error');
            }
        }

        function checkNetwork() {
            showResult('networkResult', 'æ­£åœ¨æ£€æŸ¥ç½‘ç»œè¿æ¥...', 'info');
            
            const results = [];
            
            // æ£€æŸ¥ç½‘ç»œçŠ¶æ€
            results.push(`ç½‘ç»œåœ¨çº¿çŠ¶æ€: ${navigator.onLine ? 'åœ¨çº¿' : 'ç¦»çº¿'}`);
            
            // æ£€æŸ¥å½“å‰åŸŸå
            results.push(`å½“å‰åŸŸå: ${window.location.origin}`);
            
            // æ£€æŸ¥APIç«¯ç‚¹
            results.push(`APIä»£ç†ç«¯ç‚¹: ${window.location.origin}/api/*`);
            
            // æ£€æŸ¥åç«¯æœåŠ¡
            fetch('http://localhost:8001/health')
                .then(response => {
                    results.push(`åç«¯å¥åº·æ£€æŸ¥: ${response.ok ? 'æ­£å¸¸' : 'å¼‚å¸¸'}`);
                    showResult('networkResult', results.join('<br>'), 'info');
                })
                .catch(error => {
                    results.push(`åç«¯å¥åº·æ£€æŸ¥: æ— æ³•è¿æ¥ (${error.message})`);
                    showResult('networkResult', results.join('<br>'), 'info');
                });
        }

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨è¿è¡ŒåŸºæœ¬æ£€æŸ¥
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(checkNetwork, 1000);
        });
    </script>
</body>
</html>