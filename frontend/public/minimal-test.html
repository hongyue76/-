<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æœ€å°åŒ–ç¦»çº¿æŒ‡ç¤ºå™¨æµ‹è¯•</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .test-container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            max-width: 500px;
            margin: 0 auto;
        }
        .status-indicator {
            padding: 15px;
            margin: 10px 0;
            border-radius: 5px;
            text-align: center;
            font-weight: bold;
        }
        .online {
            background: #e8f5e8;
            color: #2e7d32;
            border: 1px solid #c8e6c9;
        }
        .offline {
            background: #ffebee;
            color: #c62828;
            border: 1px solid #ffcdd2;
        }
        .partial {
            background: #fff8e1;
            color: #f57c00;
            border: 1px solid #ffecb3;
        }
        button {
            padding: 10px 20px;
            margin: 5px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            background: #1976d2;
            color: white;
        }
        button:hover {
            background: #1565c0;
        }
        .debug-info {
            background: #f5f5f5;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
            font-family: monospace;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>ğŸ“¡ ç®€åŒ–ç¦»çº¿æŒ‡ç¤ºå™¨æµ‹è¯•</h1>
        
        <div id="statusIndicator" class="status-indicator">
            åˆå§‹åŒ–ä¸­...
        </div>
        
        <div class="debug-info" id="debugInfo">
            è°ƒè¯•ä¿¡æ¯åŠ è½½ä¸­...
        </div>
        
        <div>
            <button onclick="toggleNetwork()">åˆ‡æ¢ç½‘ç»œçŠ¶æ€</button>
            <button onclick="toggleServer()">åˆ‡æ¢æœåŠ¡å™¨çŠ¶æ€</button>
            <button onclick="refreshStatus()">åˆ·æ–°çŠ¶æ€</button>
        </div>
    </div>

    <script>
        // æ¨¡æ‹ŸVueå“åº”å¼ç³»ç»Ÿçš„æ ¸å¿ƒéƒ¨åˆ†
        function createReactive(obj) {
            return new Proxy(obj, {
                get(target, prop) {
                    return target[prop];
                },
                set(target, prop, value) {
                    target[prop] = value;
                    updateStatus();
                    return true;
                }
            });
        }

        // æ¨¡æ‹Ÿç½‘ç»œçŠ¶æ€
        const mockNetworkStatus = createReactive({
            online: navigator.onLine,
            serverReachable: true,
            type: 'unknown'
        });

        const mockIsOnline = createReactive({ value: navigator.onLine });
        let currentNetworkState = 'online';

        // å®‰å…¨è·å–ç½‘ç»œå±æ€§çš„å‡½æ•°ï¼ˆæ¨¡æ‹Ÿä¿®å¤åçš„é€»è¾‘ï¼‰
        function getNetworkProperty(property, defaultValue = null) {
            if (!mockNetworkStatus) return defaultValue;
            return mockNetworkStatus[property] ?? defaultValue;
        }

        // è®¡ç®—æŒ‡ç¤ºå™¨ç±»ï¼ˆæ¨¡æ‹ŸVueè®¡ç®—å±æ€§ï¼‰
        function getIndicatorClasses() {
            return {
                'online': mockIsOnline.value && getNetworkProperty('serverReachable', true),
                'offline': !mockIsOnline.value,
                'partial': mockIsOnline.value && !getNetworkProperty('serverReachable', true)
            };
        }

        // æ›´æ–°çŠ¶æ€æ˜¾ç¤º
        function updateStatus() {
            const indicator = document.getElementById('statusIndicator');
            const debugInfo = document.getElementById('debugInfo');
            const classes = getIndicatorClasses();
            
            // æ¸…é™¤ç°æœ‰ç±»
            indicator.className = 'status-indicator';
            
            // åº”ç”¨æ–°ç±»
            if (classes.online) {
                indicator.classList.add('online');
                indicator.textContent = 'ğŸŸ¢ å®Œå…¨åœ¨çº¿';
                currentNetworkState = 'online';
            } else if (classes.partial) {
                indicator.classList.add('partial');
                indicator.textContent = 'ğŸŸ¡ éƒ¨åˆ†è¿æ¥';
                currentNetworkState = 'partial';
            } else {
                indicator.classList.add('offline');
                indicator.textContent = 'ğŸ”´ ç¦»çº¿çŠ¶æ€';
                currentNetworkState = 'offline';
            }
            
            // æ›´æ–°è°ƒè¯•ä¿¡æ¯
            debugInfo.innerHTML = `
                <strong>è°ƒè¯•ä¿¡æ¯:</strong><br>
                isOnline.value: ${mockIsOnline.value}<br>
                networkStatus.serverReachable: ${getNetworkProperty('serverReachable', 'undefined')}<br>
                networkStatus.online: ${getNetworkProperty('online', 'undefined')}<br>
                è®¡ç®—ç»“æœ - online: ${classes.online}, partial: ${classes.partial}, offline: ${classes.offline}<br>
                å½“å‰çŠ¶æ€: ${currentNetworkState}
            `;
        }

        // åˆ‡æ¢ç½‘ç»œçŠ¶æ€
        function toggleNetwork() {
            mockIsOnline.value = !mockIsOnline.value;
            mockNetworkStatus.online = mockIsOnline.value;
            console.log('åˆ‡æ¢ç½‘ç»œçŠ¶æ€åˆ°:', mockIsOnline.value);
        }

        // åˆ‡æ¢æœåŠ¡å™¨çŠ¶æ€
        function toggleServer() {
            mockNetworkStatus.serverReachable = !mockNetworkStatus.serverReachable;
            console.log('åˆ‡æ¢æœåŠ¡å™¨çŠ¶æ€åˆ°:', mockNetworkStatus.serverReachable);
        }

        // åˆ·æ–°çŠ¶æ€
        function refreshStatus() {
            updateStatus();
            console.log('æ‰‹åŠ¨åˆ·æ–°çŠ¶æ€');
        }

        // é¡µé¢åŠ è½½å®Œæˆ
        document.addEventListener('DOMContentLoaded', function() {
            console.log('é¡µé¢åˆå§‹åŒ–å®Œæˆ');
            updateStatus();
            
            // ç›‘å¬çœŸå®ç½‘ç»œå˜åŒ–
            window.addEventListener('online', function() {
                console.log('æ£€æµ‹åˆ°ç½‘ç»œè¿æ¥');
                mockIsOnline.value = true;
                mockNetworkStatus.online = true;
            });
            
            window.addEventListener('offline', function() {
                console.log('æ£€æµ‹åˆ°ç½‘ç»œæ–­å¼€');
                mockIsOnline.value = false;
                mockNetworkStatus.online = false;
            });
        });

        // æ¨¡æ‹Ÿå¯èƒ½å‡ºç°çš„é”™è¯¯æƒ…å†µ
        function simulateErrorScenario() {
            console.log('æ¨¡æ‹Ÿé”™è¯¯åœºæ™¯...');
            
            // æ¨¡æ‹ŸnetworkStatusä¸ºundefinedçš„æƒ…å†µ
            const originalNetworkStatus = mockNetworkStatus;
            mockNetworkStatus = undefined;
            updateStatus();
            
            // æ¢å¤
            setTimeout(() => {
                mockNetworkStatus = originalNetworkStatus;
                updateStatus();
                console.log('é”™è¯¯åœºæ™¯æµ‹è¯•å®Œæˆ');
            }, 2000);
        }

        // æ·»åŠ æµ‹è¯•æŒ‰é’®
        document.addEventListener('DOMContentLoaded', function() {
            const container = document.querySelector('.test-container');
            const errorButton = document.createElement('button');
            errorButton.textContent = 'æµ‹è¯•é”™è¯¯åœºæ™¯';
            errorButton.onclick = simulateErrorScenario;
            errorButton.style.background = '#f44336';
            container.appendChild(errorButton);
        });
    </script>
</body>
</html>